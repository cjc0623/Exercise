<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영화 재생</title>
    <link rel="stylesheet" href="../Css/video.css">
    <link rel="shortcut icon" href="https://assets.coupangplay.com/favicon.ico" type="image/x-icon">
    <style>
        /* 영화 플레이어 전용 스타일 */
        .video-player {
            max-width: 900px;
            /* 최대 너비 제한 */
            margin: 0 auto;
            /* 중앙 정렬 */
        }

        .video-player img {
            max-height: 500px;
            /* 최대 높이 제한 */
            object-fit: contain;
            /* 비율 유지하며 맞춤 */
        }
    </style>
</head>

<body>
    <div class="video-header">
        <button class="back-btn" onclick="history.back()">←</button>
        <div class="video-title" id="header-title">로딩 중...</div>
    </div>

    <div class="main-container">
        <div class="video-section" style="flex: 1; max-width: 100%;">
            <div class="video-player">
                <img id="video-poster" class="video-placeholder" src="" alt="포스터">
                <div class="play-overlay" onclick="alert('실제 영상 재생 기능은 구현되지 않았습니다.')">
                    <div class="play-icon"></div>
                </div>
            </div>

            <!-- 비디오 정보 -->
            <div class="video-info">
                <h1 id="movie-title">로딩 중...</h1>
                <div class="video-meta" id="movie-meta">
                    <span class="rating">⭐ 0.0</span>
                    <span>0000</span>
                    <span>0분</span>
                </div>
                <div class="video-description" id="movie-description">
                    설명을 불러오는 중...
                </div>
                <div class="video-details">
                    <div class="detail-row">
                        <span class="detail-label">출연진:</span>
                        <span class="detail-value" id="movie-cast">로딩 중...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">감독:</span>
                        <span class="detail-value" id="movie-director">로딩 중...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">장르:</span>
                        <span class="detail-value" id="movie-genres">로딩 중...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">개봉일:</span>
                        <span class="detail-value" id="movie-release">로딩 중...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">국가:</span>
                        <span class="detail-value" id="movie-country">로딩 중...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwZjliNTBhYTY0NTE2ZmU3MTYxZGU4MGU4M2U4OWE0NSIsIm5iZiI6MTc2ODQ1NzEwNC45MzcsInN1YiI6IjY5Njg4MzkwMTM1OWNmNzAxY2Y0MDhiYyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Z3WWHuczoqdcg2W96oUfJQTTuYe8ImaMYUomoCXBQJA";
        const IMG_BASE = "https://image.tmdb.org/t/p/original";
        const BASE_URL = "https://api.themoviedb.org/3";

        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: `Bearer ${API_KEY}`
            }
        };

        // URL에서 영화 ID 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        if (!movieId) {
            alert('영화 ID가 없습니다.');
            history.back();
        }

        // 페이지 로드
        async function loadPage() {
            try {
                // 영화 상세 정보
                const [detailRes, creditsRes] = await Promise.all([
                    fetch(`${BASE_URL}/movie/${movieId}?language=ko-KR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/credits?language=ko-KR`, options)
                ]);

                const detail = await detailRes.json();
                const credits = await creditsRes.json();

                // 헤더 제목
                document.getElementById('header-title').textContent = detail.title;

                // 포스터 이미지
                document.getElementById('video-poster').src = IMG_BASE + (detail.backdrop_path || detail.poster_path);

                // 제목
                document.getElementById('movie-title').textContent = detail.title;

                // 메타 정보
                const year = detail.release_date ? detail.release_date.split('-')[0] : '';
                const runtime = detail.runtime ? `${detail.runtime}분` : '';

                document.getElementById('movie-meta').innerHTML = `
                    <span class="rating">⭐ ${detail.vote_average.toFixed(1)}</span>
                    <span>${year}</span>
                    ${runtime ? `<span>${runtime}</span>` : ''}
                `;

                // 설명
                document.getElementById('movie-description').textContent =
                    detail.overview || '정보가 없습니다.';

                // 출연진
                const cast = credits.cast.slice(0, 5).map(c => c.name).join(', ');
                document.getElementById('movie-cast').textContent = cast || '정보 없음';

                // 감독
                const director = credits.crew.find(c => c.job === 'Director');
                document.getElementById('movie-director').textContent =
                    director ? director.name : '정보 없음';

                // 장르
                const genres = detail.genres.map(g => g.name).join(', ');
                document.getElementById('movie-genres').textContent = genres || '정보 없음';

                // 개봉일
                document.getElementById('movie-release').textContent =
                    detail.release_date || '정보 없음';

                // 국가
                const countries = detail.production_countries.map(c => c.name).join(', ');
                document.getElementById('movie-country').textContent = countries || '정보 없음';


                tvarr = ["movie", movieId, IMG_BASE + (detail.backdrop_path || detail.poster_path)];
                let log = localStorage.getItem("log");
                let logArray = log ? JSON.parse(log) : [];

                // 중복 제거 (같은 ID의 항목 삭제)
                logArray = logArray.filter(item => !(item[0] === "movie" && item[1] === movieId));

                logArray.push(tvarr);
                localStorage.setItem("log", JSON.stringify(logArray));

            } catch (error) {
                console.error('Error:', error);
                alert('정보를 불러오는데 실패했습니다.');
            }
        }

        // 페이지 로드 시 실행
        loadPage();
    </script>
</body>

</html>