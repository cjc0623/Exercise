<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œí•„</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link rel="shortcut icon" href="https://assets.coupangplay.com/favicon.ico" type="image/x-icon">
    <style>
        /* [ê¸°ë³¸ ìŠ¤íƒ€ì¼] */
        * { box-sizing: border-box; }
        body { 
            margin: 0; background-color: #000; color: #fff; 
            font-family: "Pretendard Variable", sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; position: relative; overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        input, button { font-family: inherit; outline: none; }

        /* [í—¤ë”] */
        .header { position: absolute; top: 0; left: 0; width: 100%; padding: 30px 40px; display: flex; justify-content: center; z-index: 10; }
        .header-logo { width: 140px; filter: brightness(0) invert(1); }
       

        /*  í”„ë¡œí•„ ì„ íƒ ë¦¬ìŠ¤íŠ¸ */
        #profile-select-wrap { display: flex; flex-direction: column; align-items: center; width: 100%; z-index: 20; }
        h1#main-title { font-size: 32px; font-weight: 700; margin-bottom: 60px; text-align: center; }

        .profile-list { display: flex; gap: 40px; flex-wrap: wrap; justify-content: center; margin-bottom: 60px; }
        .profile-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; }
        
        .img-wrapper { position: relative; width: 130px; height: 130px; }
        .profile-img {
            width: 100%; height: 100%; border-radius: 50%;
            background-color: #333; display: flex; justify-content: center; align-items: center;
            font-size: 46px; font-weight: 700; color: #fff;
            border: 3px solid transparent; transition: 0.2s;
        }
        .profile-item:hover .profile-img { border-color: #fff; transform: scale(1.05); }
        .profile-name { margin-top: 15px; font-size: 18px; color: #ccc; font-weight: 500; text-align: center; }
        .profile-item:hover .profile-name { color: #fff; }

        /* ì—°í•„ ì˜¤ë²„ë ˆì´ (ìˆ˜ì • ëª¨ë“œì¼ë•Œ) */
        .edit-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); border-radius: 50%;
            display: none; justify-content: center; align-items: center;
            border: 2px solid #fff;
        }
        .edit-overlay svg { width: 32px; height: 32px; fill: #fff; }

        /* ë©”ì¸ í•˜ë‹¨ ë²„íŠ¼ (í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°/ì·¨ì†Œ) */
        .main-action-btn {
            padding: 12px 30px; background-color: #252525; color: #fff;
            font-size: 16px; font-weight: 600; border-radius: 6px; border: none;
            display: flex; align-items: center; gap: 8px; cursor: pointer; transition: 0.2s;
        }
        .main-action-btn:hover { background-color: #444; }


        /* í”„ë¡œí•„ ìˆ˜ì • í™”ë©´ */
        #profile-edit-wrap { 
            display: none;
            flex-direction: column; align-items: center; 
            width: 100%; max-width: 440px; 
            padding-bottom: 50px; 
            z-index: 20;
            margin-top: 80px; 
        }
        
        /* íƒ€ì´í‹€ ìŠ¤íƒ€ì¼: ë§ˆì§„ ì¡°ì • */
        .edit-title-text { font-size: 28px; font-weight: 700; margin-bottom: 40px; text-align: center; }
        
        .edit-img-box {
            width: 120px; height: 120px; border-radius: 50%; background-color: #333;
            display: flex; justify-content: center; align-items: center;
            font-size: 40px; font-weight: 700; color: #fff; margin-bottom: 40px;
            position: relative; opacity: 0.8;
        }
        .edit-pencil-badge {
            position: absolute; bottom: 0; right: 0;
            width: 36px; height: 36px; border-radius: 50%; background-color: #333;
            display: flex; justify-content: center; align-items: center; border: 1px solid #555;
        }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-group { width: 100%; margin-bottom: 12px; position: relative; }
        .cp-input {
            width: 100%; padding: 16px; background-color: #1a1b1d;
            border: 1px solid #333; border-radius: 6px; color: #fff; font-size: 16px; cursor: pointer;
        }
        .cp-input:focus { border-color: #fff; outline: none; }
        .cp-input[readonly] { cursor: pointer; background-color: #1a1b1d; } /* readonly ë°°ê²½ìƒ‰ ëª…ì‹œ */
        
        /* ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .dropdown-list {
            position: absolute; top: 100%; left: 0; width: 100%; max-height: 250px; overflow-y: auto;
            background: #252525; border: 1px solid #333; border-radius: 6px;
            z-index: 100; display: none; 
        }
        .dropdown-item { padding: 15px; cursor: pointer; font-size: 15px; border-bottom: 1px solid #333; }
        .dropdown-item:hover { background-color: #0074E9; }

        .info-text { width: 100%; text-align: left; font-size: 12px; color: #888; margin: 10px 0 30px; line-height: 1.5; }

        .menu-btn {
            width: 100%; padding: 18px 20px; background-color: #1a1b1d;
            border: 1px solid #333; border-radius: 6px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; margin-bottom: 40px;
        }
        
        /* í•˜ë‹¨ ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .save-btn { width: 100%; padding: 16px; background: #252525; color: #666; font-weight: bold; font-size: 16px; border-radius: 6px; border: none; cursor: not-allowed; margin-bottom: 15px; }
        .save-btn.active { background: #0074E9; color: #fff; cursor: pointer; }
        
        .cancel-text-btn { background: none; border: none; color: #ccc; font-weight: 600; cursor: pointer; font-size: 15px; padding: 10px; }
        
        /* êµ¬ë¶„ì„  ë° ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .divider-line { width: 100%; height: 1px; background-color: #333; margin: 15px 0 25px; }
        .delete-text-btn { color: #E52528; text-decoration: underline; cursor: pointer; font-size: 15px; font-weight: 600; padding: 10px; }

        /* ë¹„ë°€ë²ˆí˜¸ íŒì—… */
        #pw-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8); z-index: 3000;
            display: none; justify-content: center; align-items: center;
        }
        .pw-box { width: 360px; background: #222; padding: 40px 30px; border-radius: 12px; text-align: center; position: relative; }
        .pw-close { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 20px; color: #fff; }
        .pw-input { 
            width: 100%; padding: 14px; background: #333; border: 1px solid #444; color: #fff; 
            border-radius: 4px; margin-bottom: 20px; font-size: 18px; text-align: center; letter-spacing: 5px;
        }
        .pw-btn { width: 100%; padding: 14px; background: #444; color: #777; border-radius: 4px; font-weight: bold; border: none; cursor: not-allowed; }
        .pw-btn.active { background: #0074E9; color: #fff; cursor: pointer; }

    </style>
</head>
<body>

    <div id="profile-select-wrap">
        <h1 id="main-title">ì‹œì²­í•  í”„ë¡œí•„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h1>
        <div class="profile-list" id="profile-list-area"></div>
        <button class="main-action-btn" id="edit-toggle-btn" onclick="toggleEditMode()">
            <svg id="pencil-icon" viewBox="0 0 24 24" width="18" height="18" fill="white" style="margin-right:5px;"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
            <span id="btn-text">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</span>
        </button>
    </div>

    <div id="profile-edit-wrap">
        <div class="edit-title-text">í”„ë¡œí•„ ìˆ˜ì •</div>
        
        <div class="edit-img-box" id="edit-img-box">
            <span id="edit-initial">?</span>
            <div class="edit-pencil-badge">
                <svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg>
            </div>
        </div>

        <div class="form-group">
            <input type="text" id="edit-name" class="cp-input" placeholder="ì´ë¦„" autocomplete="off" oninput="checkSaveBtn()">
        </div>
        
        <div class="form-group">
            <input type="text" id="edit-gender" class="cp-input" placeholder="(ì„ íƒ) ì„±ë³„ ì…ë ¥" readonly onclick="toggleDropdown('drop-gender')">
            <div id="drop-gender" class="dropdown-list">
                <div class="dropdown-item" onclick="selectValue('edit-gender', 'ë‚¨ì„±')">ë‚¨ì„±</div>
                <div class="dropdown-item" onclick="selectValue('edit-gender', 'ì—¬ì„±')">ì—¬ì„±</div>
            </div>
        </div>
        <div class="form-group">
            <input type="text" id="edit-birth" class="cp-input" placeholder="(ì„ íƒ) ì¶œìƒë…„ë„ ì…ë ¥" readonly onclick="toggleDropdown('drop-birth')">
            <div id="drop-birth" class="dropdown-list"></div>
        </div>

        <div class="info-text">
            ì„±ë³„ê³¼ ì¶œìƒë…„ë„ëŠ” ì„ íƒ ì…ë ¥ ì‚¬í•­ì´ë©°... (ìƒëµ)<br>
            <span style="text-decoration:underline; cursor:pointer;">ì „ë¬¸ ë³´ê¸° ></span>
        </div>

        <div class="menu-btn" onclick="openPwModal()">
            <div style="font-weight:600; display:flex; align-items:center; gap:8px;">ğŸ”’ ì‹œì²­ ì—°ë ¹ ì„¤ì •</div>
            <div style="color:#888; font-size:14px;">19ì„¸ ì´ìƒ ê´€ëŒê°€ â€º</div>
        </div>

        <div class="btn-group">
            <button class="save-btn" id="save-btn" onclick="saveProfile()">ì €ì¥í•˜ê¸°</button>
            <button class="cancel-text-btn" onclick="exitEditScene()">ì·¨ì†Œ</button>
            
            <div class="divider-line"></div>
            <div class="delete-text-btn" onclick="deleteProfile()">í”„ë¡œí•„ ì‚­ì œí•˜ê¸°</div>
        </div>
    </div>

    <div id="pw-modal">
        <div class="pw-box">
            <div class="pw-close" onclick="closePwModal()">âœ•</div>
            <h2 style="margin-bottom:10px; font-size:20px;">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2>
            <p style="color:#aaa; font-size:14px; margin-bottom:25px; line-height:1.4;">ì‹œì²­ ì—°ë ¹ ì„¤ì •ì„ ìœ„í•´<br>ê³„ì • ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
            <input type="password" id="modal-pw" class="pw-input" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="â—â—â—â—" oninput="checkPwInput(this)">
            <button id="modal-confirm" class="pw-btn" onclick="confirmPassword()">í™•ì¸</button>
            <div style="margin-top:20px; font-size:13px; color:#888; text-decoration:underline; cursor:pointer;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì—ˆë‚˜ìš”</div>
        </div>
    </div>

    <script>
        var profiles = []; 
        var isEditMode = false;
        var editingProfileId = null; 

        function init() {
            // localStorageì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            var stored = localStorage.getItem('coupangProfiles');
            if (stored) {
                profiles = JSON.parse(stored);
            } else {
                // ë°ì´í„° ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ (í…ŒìŠ¤íŠ¸ìš©)
                profiles = [{ id: 1, name: "í…ŒìŠ¤íŠ¸", color: "#1E88E5", isKid: false }];
                localStorage.setItem('coupangProfiles', JSON.stringify(profiles));
            }
            
            renderList(); 
            initYearDropdown();
        }
        init();

        // ì €ì¥ì†Œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function saveProfilesToStorage() {
            localStorage.setItem('coupangProfiles', JSON.stringify(profiles));
        }

        // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderList() {
            var list = document.getElementById('profile-list-area');
            list.innerHTML = "";
            
            profiles.forEach((p) => {
                var item = document.createElement('div');
                item.className = 'profile-item';
                
                // í´ë¦­ ì´ë²¤íŠ¸: ìˆ˜ì • ëª¨ë“œë©´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ, ì•„ë‹ˆë©´ ë§ˆì´í˜ì´ì§€ë¡œ
                item.onclick = function() {
                    if(isEditMode) {
                        openEditScene(p.id); 
                    } else {
                        localStorage.setItem('coupangActiveProfileId', p.id);
                        location.href = "Layout.html";
                    }
                };

                var overlayStyle = isEditMode ? 'display:flex;' : 'display:none;';
                var initial = p.isKid ? "í‚¤ì¦ˆ" : p.name.substring(0, 1);
                var fontSize = p.isKid ? "20px" : "46px";

                item.innerHTML = `
                    <div class="img-wrapper">
                        <div class="profile-img" style="background-color:${p.color}; font-size:${fontSize};">${initial}</div>
                        <div class="edit-overlay" style="${overlayStyle}">
                            <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        </div>
                    </div>
                    <div class="profile-name">${p.name}</div>
                `;
                list.appendChild(item);
            });

            // ì¶”ê°€ ë²„íŠ¼ (ìˆ˜ì • ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ í‘œì‹œ)
            if(!isEditMode) {
                var addBtn = document.createElement('div');
                addBtn.className = 'profile-item';
                addBtn.innerHTML = `
                    <div class="img-wrapper">
                        <div class="profile-img" style="background-color:#222; color:#555; font-weight:300; font-size:50px;">+</div>
                    </div>
                    <div class="profile-name">í”„ë¡œí•„ ì¶”ê°€</div>
                `;
                addBtn.onclick = function() { location.href = "coupang-onboarding.html"; };
                list.appendChild(addBtn);
            }
        }

        // ìˆ˜ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼
        function toggleEditMode() {
            isEditMode = !isEditMode;
            var title = document.getElementById('main-title');
            var btnText = document.getElementById('btn-text');
            var icon = document.getElementById('pencil-icon');

            if(isEditMode) {
                title.innerText = "ìˆ˜ì •í•  í”„ë¡œí•„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”";
                btnText.innerText = "ì·¨ì†Œ";
                icon.style.display = 'none';
            } else {
                title.innerText = "ì‹œì²­í•  í”„ë¡œí•„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”";
                btnText.innerText = "í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°";
                icon.style.display = 'block';
            }
            renderList();
        }

        // ìˆ˜ì • í™”ë©´ ì—´ê¸°
        function openEditScene(id) {
            editingProfileId = id;
            var p = profiles.find(p => p.id === id);

            // í™”ë©´ ì „í™˜
            document.getElementById('profile-select-wrap').style.display = 'none';
            document.getElementById('profile-edit-wrap').style.display = 'flex';
            
            // ë°ì´í„° ì±„ìš°ê¸°
            var imgBox = document.getElementById('edit-img-box');
            imgBox.style.backgroundColor = p.color;
            document.getElementById('edit-initial').innerText = p.isKid ? "í‚¤ì¦ˆ" : p.name.substring(0, 1);
            document.getElementById('edit-initial').style.fontSize = p.isKid ? "18px" : "40px";

            document.getElementById('edit-name').value = p.name;
            document.getElementById('edit-gender').value = p.gender || "";
            document.getElementById('edit-birth').value = p.birthYear || "";

            checkSaveBtn();
            closeAllDropdowns();
        }

        // ìˆ˜ì • í™”ë©´ ë‹«ê¸° (ì·¨ì†Œ)
        function exitEditScene() {
            document.getElementById('profile-edit-wrap').style.display = 'none';
            document.getElementById('profile-select-wrap').style.display = 'flex';
            editingProfileId = null;
            // ìˆ˜ì • ëª¨ë“œ í•´ì œ (ì„ íƒ ì‚¬í•­, UXì— ë”°ë¼ ê²°ì •)
            if(isEditMode) toggleEditMode();
        }

        // ì €ì¥ ë²„íŠ¼ í™œì„±í™” ì²´í¬
        function checkSaveBtn() {
            var val = document.getElementById('edit-name').value;
            var btn = document.getElementById('save-btn');
            if(val && val.trim().length > 0) btn.classList.add('active');
            else btn.classList.remove('active');
        }

        // í”„ë¡œí•„ ì €ì¥
        function saveProfile() {
            var newName = document.getElementById('edit-name').value;
            var newGender = document.getElementById('edit-gender').value;
            var newBirth = document.getElementById('edit-birth').value;

            if(newName && newName.trim().length > 0 && editingProfileId !== null) {
                var targetIdx = profiles.findIndex(p => p.id === editingProfileId);
                if (targetIdx !== -1) {
                    profiles[targetIdx].name = newName;
                    profiles[targetIdx].gender = newGender;
                    profiles[targetIdx].birthYear = newBirth;
                    
                    saveProfilesToStorage();
                    renderList();
                    exitEditScene();
                }
            }
        }
        
        // í”„ë¡œí•„ ì‚­ì œ ê¸°ëŠ¥
        function deleteProfile() {
            if(confirm("ì •ë§ ì´ í”„ë¡œí•„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                profiles = profiles.filter(p => p.id !== editingProfileId);
                saveProfilesToStorage();
                renderList();
                exitEditScene();
            }
        }

        // ë“œë¡­ë‹¤ìš´ ê´€ë ¨ í•¨ìˆ˜
        function initYearDropdown() {
            var html = "";
            var currentYear = new Date().getFullYear();
            for (var y = currentYear; y >= 1950; y--) {
                html += `<div class="dropdown-item" onclick="selectValue('edit-birth', '${y}')">${y}</div>`;
            }
            document.getElementById('drop-birth').innerHTML = html;
        }
        function toggleDropdown(dropId) {
            var drop = document.getElementById(dropId);
            var isVisible = drop.style.display === 'block';
            closeAllDropdowns();
            if (!isVisible) drop.style.display = 'block';
        }
        function selectValue(inputId, value) {
            document.getElementById(inputId).value = value;
            closeAllDropdowns();
            checkSaveBtn();
        }
        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-list').forEach(d => d.style.display = 'none');
        }
        // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°   
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.form-group')) closeAllDropdowns();
        });

        // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function openPwModal() { 
            document.getElementById('pw-modal').style.display = 'flex'; 
            document.getElementById('modal-pw').value = "";
            checkPwInput(document.getElementById('modal-pw'));
        }
        function closePwModal() { document.getElementById('pw-modal').style.display = 'none'; }
        
        function checkPwInput(el) {
            el.value = el.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ ì…ë ¥
            var btn = document.getElementById('modal-confirm');
            if(el.value.length === 4) btn.classList.add('active');
            else btn.classList.remove('active');
        }
        
        function confirmPassword() {
            // ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§ì€ ì„œë²„ê°€ í•„ìš”í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ì•Œë¦¼ë§Œ í‘œì‹œ
            alert("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨)"); 
            closePwModal();
        }
    </script>
</body>
</html>